# ADR-0002: MCP 서버 확장 (Sentry + Atlassian) (v2.4.0)

**Date**: 2025-12-10
**Status**: Active

## Context

v2.3.0에서 MCP 서버 자동 통합 기능을 도입했지만, 3개 MCP 서버(sequential-thinking, context7, serena)만 포함되어 있었습니다. 에러 트래킹(Sentry)과 프로젝트 관리(JIRA) 통합이 수동으로 이루어져야 했습니다.

## Problem

- **Sentry 수동 조회**: analyze-issue에서 Sentry 에러를 수동으로 복사-붙여넣기 필요
- **JIRA 수동 업데이트**: execute-plan 완료 후 JIRA 이슈 상태를 수동으로 업데이트
- **MCP 서버 비활성화 어려움**: deniedMcpServers 사용법이 문서화되지 않음
- **환경 변수 분산**: API 키, 토큰 관리가 일관되지 않음

## Decision

### Sentry + Atlassian MCP 서버 추가

1. **2개 MCP 서버 추가**:
   - **sentry**: Sentry 에러 트래킹 자동화
     - `SENTRY_ACCESS_TOKEN`, `OPENAI_API_KEY` 환경 변수 필요
     - analyze-issue에서 Sentry 이슈 자동 조회
   - **atlassian**: JIRA/Confluence 자동화
     - OAuth 기반 인증
     - execute-plan, document에서 JIRA 이슈 자동 업데이트
     - requirement-validator에서 AC 자동 조회

2. **MCP 서버 비활성화 가이드**:
   - `deniedMcpServers` 사용법 상세 문서화 (README.md)
   - 5개 MCP 서버별 정확한 `serverCommand` 예시 제공
   - 환경 변수 치환 주의사항 명시

3. **환경 변수 통합 관리**:
   - 모든 MCP 서버 인증 정보를 `.zshenv`에 통합
   - marketplace.json에서 환경 변수로 참조

## Impact

- **MCP 서버 총 5개**: sequential-thinking, context7, serena, sentry, atlassian
- **자동화 향상**: Sentry/JIRA 수동 작업 자동화
- **보안 강화**: 모든 민감 정보는 환경 변수로 처리
- **Breaking Change**: 없음 (완전 하위 호환, 선택적 실행)

## Alternatives

1. ❌ Sentry/JIRA MCP 서버 미포함 → 수동 작업 지속
2. ❌ 하드코딩된 토큰 사용 → 보안 리스크
3. ✅ **환경 변수 + MCP 자동 통합** → 채택

## Pattern

**MCP 서버 확장 가능성**
- 필요한 외부 서비스가 있을 때 MCP 서버로 통합
- marketplace.json에 정의만 하면 자동 활성화
- 사용자가 원하면 `deniedMcpServers`로 비활성화 가능

## Related Files

- `.claude-plugin/marketplace.json:65-87` - Sentry/Atlassian MCP 정의
- `README.md:65-150` - MCP 서버 비활성화 가이드
- `.zshenv` - 환경 변수 설정

## Lessons Learned

- 새 MCP 서버 추가 시 README에 비활성화 가이드도 함께 업데이트
- 환경 변수 사용 시 실제 값 예시 제공
- 보안 관련 정보는 절대 하드코딩하지 않기
