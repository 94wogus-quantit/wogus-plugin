# ADR-0003: Agents 시스템 축소 리팩토링 (v3.0.0)

**Date**: 2025-12-10
**Status**: Active
**Supersedes**: ADR-0001 (v2.0.0)

## Context

v2.4.0에서 5개의 Agents가 존재했지만, Skills에서 실제로 활용되는 Agent는 1개(requirement-validator)뿐이었습니다. 나머지 4개(code-refactorer, test-generator, code-reviewer, performance-analyzer)는 외부에서 단독 호출용으로만 존재하고, Skills 내부에서 호출되지 않아 72%의 dead code로 판단되었습니다.

## Problem

- **Dead Code**: 5개 Agent 중 4개가 Skills에서 미사용 (72%)
- **과잉 엔지니어링**: 단독 호출용 Agent들이 복잡한 Phase 구조로 작성됨
- **일관성 부족**: Skills와 Agents 간 통합 패턴 불명확
- **유지보수 부담**: 사용하지 않는 Agent 파일들 관리 필요

## Decision

### Agents 시스템 축소 (5개 → 1개) + Skills에 핵심 로직 통합

1. **삭제 대상 (4개)**:
   - `code-reviewer.md` (미사용 - Skills에서 호출 없음)
   - `performance-analyzer.md` (미사용 - Skills에서 호출 없음)
   - `code-refactorer.md` (analyze-issue Phase 3D에 통합)
   - `test-generator.md` (execute-plan Phase 5에 통합)

2. **유지 대상 (1개)**:
   - `requirement-validator.md` (4개 Skills에서 활발히 사용)

3. **Skills 강화**:
   - **analyze-issue Phase 3D**: code-refactorer 핵심 로직 직접 통합
     - Sequential Thinking 패턴으로 복잡도 분석
     - Cyclomatic complexity > 10, 함수 길이 > 50줄 기준
     - Extract Method/Extract Class 리팩토링 가이드
   - **execute-plan Phase 5**: test-generator 핵심 로직 직접 통합
     - AAA 패턴 (Arrange-Act-Assert) 예시
     - Given/When/Then BDD 스타일 예시
     - Happy path/Edge cases/Error handling 분류

## Impact

- **Breaking Change**: v2.4.0 → v3.0.0 (Agent 참조 변경)
- **Dead Code 제거**: 72% → 0% (4개 Agent 삭제)
- **Skills 자립성**: Agent 의존 없이 직접 기능 수행
- **유지보수 간소화**: 관리 대상 Agent 5개 → 1개

## Alternatives

1. ❌ 전체 Agents 유지 → Dead code 72% 지속
2. ❌ 전체 Agents 삭제 → requirement-validator의 AC 추적 기능 손실
3. ✅ **선택적 축소 + 핵심 통합** → 채택

## Pattern

**Agent → Skill 인라인 통합**
- 외부 단독 호출용 Agent는 제거 (ROI 낮음)
- 핵심 로직은 Skills의 Phase에 직접 통합
- AC 추적처럼 여러 Skills에서 공유하는 기능만 Agent로 유지

## Related Files

- `.claude-plugin/marketplace.json` - agents 배열 1개로 축소
- `analyze-issue/SKILL.md` - Phase 3D 강화
- `execute-plan/SKILL.md` - Phase 5 강화

## Lessons Learned

- 새 Agent 추가 전 "Skills에서 실제로 호출되는가?" 검토 필수
- 단독 호출 전용이면 Agent 대신 Skills Phase로 구현
- Agent는 여러 Skills에서 공유할 때만 생성
