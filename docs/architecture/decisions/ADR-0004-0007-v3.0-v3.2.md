# ADR-0004 ~ ADR-0007: v3.0.1 ~ v3.2.0 MCP 관련 개선사항

이 파일은 v3.0.1부터 v3.2.0까지의 MCP 서버 관련 아키텍처 결정사항들을 통합합니다.

---

## ADR-0004: Atlassian MCP Docker 기반 API 토큰 인증으로 변경 (v3.0.1)

**Date**: 2025-12-10

### Context
v2.4.0에서 추가된 Atlassian MCP 서버가 `mcp-remote` + OAuth 방식을 사용하여 브라우저 인증이 반복적으로 필요했습니다.

### Decision
Docker 기반 API 토큰 인증 방식으로 변경:
- **이전**: `npx mcp-remote https://mcp.atlassian.com/v1/sse` (OAuth)
- **현재**: `docker run ghcr.io/sooperset/mcp-atlassian:latest` (API 토큰)
- 환경 변수 3개 추가: `ATLASSIAN_URL`, `ATLASSIAN_USERNAME`, `ATLASSIAN_API_TOKEN`

### Impact
- OAuth 반복 인증 불필요
- 비대화형 환경에서도 작동
- Docker 의존성 추가

---

## ADR-0005: MCP 서버 환경 변수 통합 (v3.0.2)

**Date**: 2025-12-10

### Context
v3.0.1에서 MCP 서버들이 `args`에 직접 API 키와 토큰을 포함하여 프로세스 목록에서 민감 정보 노출 위험.

### Decision
모든 인증 정보를 `env` 블록으로 이동:
- **context7**: args에서 `--api-key` 제거 → env 블록으로
- **sentry**: args에서 `--access-token` 제거 → env 블록으로
- 환경 변수 추가: `SENTRY_HOST`

### Impact
- 프로세스 args에 토큰 노출 방지
- 모든 MCP 서버가 `env` 블록 사용
- Breaking Change: 없음

---

## ADR-0006: mcp-config Skill 추가 (v3.1.0)

**Date**: 2025-12-10

### Context
v3.0.3까지 MCP 서버 비활성화는 사용자가 직접 `.claude/settings.local.json` 파일을 편집하고 `deniedMcpServers` 배열에 정확한 `serverCommand`를 추가해야 했습니다.

### Decision
mcp-config Skill 추가:
- Phase 1: 현재 상태 파악
- Phase 2: 사용자 요청 파싱
- Phase 3: 설정 파일 수정
- Phase 4: 결과 확인

### Impact
- 자연어로 MCP 관리 가능
- 정확한 `serverCommand` 자동 처리
- 모든 MCP 상태를 테이블로 확인

---

## ADR-0007: MCP 서버 확장 (Terraform, Amplitude, Chrome DevTools) (v3.2.0)

**Date**: 2025-12-10

### Context
v3.1.0까지 5개 MCP 서버만 포함. IaC 자동화, 사용자 행동 분석, 브라우저 디버깅 통합 필요.

### Decision
3개 MCP 서버 추가:
- **terraform**: HashiCorp 공식 Docker 이미지
- **amplitude**: 사용자 행동 분석 (`AMPLITUDE_API_KEY` 필요)
- **chrome-devtools**: Chrome DevTools 연동

### Impact
- MCP 서버 총 8개
- 환경 변수 1개 추가: `AMPLITUDE_API_KEY`
- Breaking Change: 없음

---

## Common Patterns

### MCP 서버 인증 정보 처리 원칙
1. 인증 정보는 항상 `env` 블록 사용 (v3.0.2)
2. 환경 변수는 `.zshenv`에 통합 관리
3. marketplace.json에서 환경 변수로 참조
4. 예외: amplitude는 MCP 한계로 args 사용 (v3.2.1에서 수정)

### MCP 서버 확장 가능성
- 필요한 외부 서비스 → MCP 서버로 통합
- marketplace.json 정의 → 자동 활성화
- deniedMcpServers로 비활성화 가능
